!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.StormModal=t()}(this,function(){"use strict";function e(e,s){var o=[].slice.call(document.querySelectorAll(e));if(0===o.length)throw new Error("Modal cannot be initialised, no trigger elements found");return t=o.map(function(e){return STORM.UTILS.assign(Object.create(n),{node:e,settings:STORM.UTILS.merge({},i,s)}).init()})}var t=[],i={onClassName:"active",modalSelector:"js-modal",styles:[{opacity:0,visibility:"hidden",position:"absolute",overflow:"hidden",width:0,height:0},{opacity:1,visibility:"visible",overflow:"auto",position:"fixed",width:"auto",height:"auto",top:0,left:0,bottom:0,right:0,zIndex:9}]},n={init:function(){if(this.isOpen=!1,this.togglers=this.node.getAttribute("data-modal-toggler")&&[].slice.call(document.querySelectorAll("."+this.node.getAttribute("data-modal-toggler"))),!this.togglers)throw new Error("Modal cannot be initialised, no modal toggler elements found");this.togglers.forEach(function(e){e.addEventListener("click",this.toggle.bind(this),!1)}.bind(this)),this.focusableChildren=this.getFocusableChildren(),this.setStyles(),this.node.setAttribute("aria-hidden",!0)},getFocusableChildren:function(){var e=["a[href]","area[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","iframe","object","embed","[contenteditable]",'[tabindex]:not([tabindex="-1"])'];return[].slice.call(this.node.querySelectorAll(e.join(","))).filter(function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)})},trapTab:function(e){var t=this.focusableChildren.indexOf(document.activeElement);console.log(t),e.shiftKey&&0===t?(e.preventDefault(),this.focusableChildren[this.focusableChildren.length-1].focus()):e.shiftKey||t!==this.focusableChildren.length-1||(e.preventDefault(),this.focusableChildren[0].focus())},setStyles:function(){for(var e in this.settings.styles[Number(this.isOpen)])this.node.style[e]=this.settings.styles[Number(this.isOpen)][e]},keyListener:function(e){this.isOpen&&27===e.keyCode&&(e.preventDefault(),this.toggle()),this.isOpen&&9===e.keyCode&&this.trapTab(e)},open:function(){document.addEventListener("keydown",this.keyListener.bind(this)),this.lastFocused=document.activeElement,window.setTimeout(function(){this.focusableChildren[0].focus()}.bind(this),0)},close:function(){document.removeEventListener("keydown",this.keyListener.bind(this)),this.lastFocused.focus()},toggle:function(){this.isOpen?this.close():this.open(),this.isOpen=!this.isOpen,this.setStyles(),this.node.setAttribute("aria-hidden",!this.isOpen),document.querySelector("main")&&document.querySelector("main").setAttribute("aria-hidden",this.isOpen)}};return{init:e}});